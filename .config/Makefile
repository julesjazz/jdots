.PHONY: \
identities-setup \
aws-gen-config \
scan-filetypes \
check-config

# Notes:
# - returns including "make: '_' is up to date." are an expected output bug with makefile, not worth fixing.

# Handle additional arguments as target directories (prevents "No rule to make target" errors)
%:
	@:

help:
	@echo "\033[1;36mğŸš€ Usage: make <target>\033[0m"
	@echo "--------------------------------"
	@echo "\033[1;33mâ˜ï¸  AWS Tools:\033[0m"
	@echo "  \033[1;32mğŸ” identities-setup\033[0m - Setup identities for gitlab and github âš ï¸"
	@echo "  \033[1;32mâš™ï¸  aws-gen-config\033[0m - Generate AWS config, update aws accounts"
	@echo "--------------------------------"
	@echo "\033[1;33mğŸ› ï¸  Utilities:\033[0m"
	@echo "  \033[1;32mğŸ“ scan-filetypes\033[0m - Scan with: make scan-filetypes <targetdir>"
	@echo "  \033[1;32mğŸ“ check-config\033[0m - Check for .config changes"

# --- Enabling statements ---
# Handle additional arguments as target directories (prevents "No rule to make target" errors)
%:
	@:
# Get the target directory from command line arguments
TARGET_DIR := $(word 2,$(MAKECMDGOALS))

identities-setup:
	@echo -n "\033[1;33mâš ï¸  This will break working git repos. Continue? (y/N): \033[0m" && read -r response \
	&& [ "$$response" = "y" ] || [ "$$response" = "Y" ] \
	&& bash ./scripts/identities-setup.sh || echo "\033[1;31mâŒ Setup cancelled\033[0m"

aws-gen-config:
	@echo -n "\033[1;33mâš ï¸  This may break AWS configuration. Continue? (y/N): \033[0m" && read -r response \
	&& [ "$$response" = "y" ] || [ "$$response" = "Y" ] \
	&& bash ./scripts/aws-gen-config.sh || echo "\033[1;31mâŒ Generation cancelled\033[0m"

scan-filetypes:
	@echo -n "\033[1;33mâš ï¸  This may take a while for large directories. Continue? (y/N): \033[0m" && \
	read -r response && [ "$$response" = "y" ] || [ "$$response" = "Y" ] || \
	{ echo "\033[1;31mâŒ Scan cancelled\033[0m"; exit 1; } && \
	bash ./scripts/scan-filetypes.sh $(or $(TARGETDIR),$(TARGET_DIR),.) && \
	echo "\033[1;32mâœ… Scan complete ğŸ‘‰ ~/.config/scripts/temp/filetypes.txt\033[0m"

obsidian-sync:
	@echo -n "\033[1;33mâš ï¸  Copy targeted vault config to another. Continue? (y/N): \033[0m" && read -r response \
	&& [ "$$response" = "y" ] || [ "$$response" = "Y" ] \
	&& bash ./scripts/obsidian-sync.sh || echo "\033[1;31mâŒ Sync cancelled\033[0m"

check-config:
	@bash ~/.config/scripts/check-config.sh